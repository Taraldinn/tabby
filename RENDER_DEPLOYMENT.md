# Tabbycat Deployment on Render.com (Free Tier)

This guide helps you deploy Tabbycat on Render.com using their free tier services.

## Required Services

Tabbycat requires **4 services** on Render's free tier:

1. **Web Service** - Main Django application
2. **Web Service (Worker)** - Handles async tasks (notifications, allocations)*
3. **PostgreSQL Database** - Data storage (Free: 256 MB, 1 GB storage)
4. **Redis** - Session storage and task queue (Free: 25 MB)

*Note: Background Worker service type is not available on free tier, so we use a Web Service configured to run worker tasks.

## Deployment Options

### Option 1: Blueprint Deployment (Recommended)

1. **Fork this repository** to your GitHub account
2. **Connect to Render**:
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New" → "Blueprint"
   - Connect your GitHub account and select your forked repository
3. **Deploy using render.yaml**:
   - Render will automatically detect the `render.yaml` file
   - Review the services to be created
   - Click "Apply" to deploy all services at once

### Option 2: Manual Service Creation

If you prefer to create services manually:

#### 1. Create PostgreSQL Database
- **Service Type**: PostgreSQL
- **Name**: `tabbycat_database` 
- **Database Name**: `tabbycat`
- **User**: `tabbycat`
- **Plan**: Free

#### 2. Create Redis Instance
- **Service Type**: Redis
- **Name**: `tabbycat_redis`
- **Plan**: Free
- **IP Allow List**: `0.0.0.0` (everywhere)

#### 3. Create Web Service
- **Service Type**: Web Service
- **Name**: `tabbycat_website`
- **Environment**: Python
- **Plan**: Free
- **Build Command**: `./bin/render-compile.sh`
- **Start Command**: `npm run render-serve`
- **Environment Variables**:
  ```
  DATABASE_URL=<connection string from postgres service>
  REDIS_URL=<connection string from redis service>
  DJANGO_SECRET_KEY=<generate random value>
  PYTHON_VERSION=3.12.3
  WEB_CONCURRENCY=2
  ON_RENDER=true
  USING_NGINX=0
  DEBUG=false
  ALLOWED_HOSTS=*
  ```

#### 4. Create Worker Service (as Web Service)
- **Service Type**: Web Service
- **Name**: `tabbycat_worker`
- **Environment**: Python
- **Plan**: Free
- **Build Command**: `./bin/render-compile.sh`
- **Start Command**: `npm run render-worker`
- **Environment Variables**: Same as Web Service

*Note: Since Background Worker is not available on free tier, we use a Web Service configured to run worker processes.*

## Configuration Settings

### Required Environment Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `DATABASE_URL` | PostgreSQL connection string | Auto-generated by Render |
| `REDIS_URL` | Redis connection string | Auto-generated by Render |
| `DJANGO_SECRET_KEY` | Django secret key | Auto-generated by Render |
| `TAB_DIRECTOR_EMAIL` | Your email address | `admin@yourdomain.com` |
| `TIME_ZONE` | Tournament timezone | `America/New_York` |

### Optional Settings

| Variable | Default | Description |
|----------|---------|-------------|
| `WEB_CONCURRENCY` | 2 | Number of web workers (free tier limit) |
| `DEBUG` | false | Debug mode (keep false in production) |
| `ALLOWED_HOSTS` | * | Allowed hosts for Django |

## Free Tier Limitations

### Resource Limits
- **Web/Worker Services**: 750 hours/month each (auto-sleep after 15min inactivity)
- **PostgreSQL**: 256 MB RAM, 1 GB storage, expires after 30 days
- **Redis**: 25 MB storage
- **Build Time**: 15 minutes maximum

### Performance Optimizations
- `WEB_CONCURRENCY` set to 2 (instead of 4) to stay within memory limits
- Services auto-sleep when inactive (15 minutes)
- Database connections are pooled efficiently

## Post-Deployment Setup

1. **Access your application** at the URL provided by Render
2. **Create superuser account**:
   ```bash
   # Via Render dashboard shell or local management
   python manage.py createsuperuser
   ```
3. **Configure tournament settings** in the admin panel
4. **Set your tab director email** in environment variables

## Monitoring and Maintenance

### Service Status
- Monitor service health in Render dashboard
- Check logs for any deployment issues
- Services automatically restart on failures

### Database Backup
⚠️ **Important**: Free PostgreSQL databases expire after 30 days
- Export your data regularly via Django admin
- Consider upgrading to paid tier for permanent storage

### Updates
- Push changes to your connected GitHub repository
- Render automatically rebuilds and deploys
- Worker and web services restart independently

## Troubleshooting

### Common Issues

1. **Build failures**:
   - Check that `bin/render-compile.sh` is executable
   - Verify Python/Node.js versions in logs

2. **Database connection errors**:
   - Ensure `DATABASE_URL` is correctly set
   - Check PostgreSQL service is running

3. **Redis connection errors**:
   - Verify `REDIS_URL` environment variable
   - Ensure Redis service is accessible

4. **Static files not loading**:
   - Check that `collectstatic` completed successfully
   - Verify build process completed without errors

### Getting Help

- Check Render logs in dashboard
- Review Django logs for application errors
- Consult [Tabbycat documentation](https://tabbycat.readthedocs.io/)
- Join [Tabbycat Facebook group](https://www.facebook.com/groups/tabbycatsupport/)

## Cost Optimization

The free tier provides:
- **$0/month** for basic usage
- Suitable for small to medium tournaments
- Services sleep when inactive (good for testing)

For production tournaments, consider:
- Upgrading PostgreSQL to paid tier for persistence
- Using paid web services to avoid sleep delays
- Adding custom domain with paid plan